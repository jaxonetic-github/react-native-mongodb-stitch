var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.add=add;exports.remove=remove;exports.clear=clear;exports.default=void 0;var _subscriptions2=_interopRequireDefault(require("./subscriptions"));var _nativeInterface=_interopRequireDefault(require("./nativeInterface"));var _deprecatedUtils=_interopRequireDefault(require("./deprecatedUtils"));var _subscriptions=new Set();var _latestState=null;var _isListening=false;function _listenerHandler(state){var convertedState=_deprecatedUtils.default.convertState(state);_latestState=convertedState;_subscriptions.forEach(function(handler){return handler(convertedState);});}function add(handler){_subscriptions.add(handler);if(_latestState){handler(_latestState);}else{_nativeInterface.default.getCurrentState().then(function(state){_latestState=_deprecatedUtils.default.convertState(state);handler(_latestState);});}if(_subscriptions.size>0&&!_isListening){_subscriptions2.default.add(_listenerHandler,false);_isListening=true;}}function remove(handler){_subscriptions.delete(handler);if(_subscriptions.size===0&&_isListening){_subscriptions2.default.remove(_listenerHandler);_isListening=false;}}function clear(){_subscriptions.clear();if(_isListening){_subscriptions2.default.remove(_listenerHandler);_isListening=false;}}var _default={add:add,remove:remove,clear:clear};exports.default=_default;
//# sourceMappingURL=deprecatedSubscriptions.js.map